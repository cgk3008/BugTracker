@model BugTracker.Models.Ticket

@{
	ViewBag.Title = "Details";
}

<div class="main-content">
	<div class="container">

		<div class="page-content">

			<!-- Heading -->
			<div class="single-head">
				<!-- Heading -->
				<h2 class="pull-left"><i class="fa fa-ticket blue"></i> Ticket Details</h2>


				@if (User.IsInRole("Admin") || User.IsInRole("Project Manager"))
				{
					<div class="col-md-4">
						<h2>
							<i class="fa fa-ticket green"></i>
							@Html.ActionLink("Assign This Ticket", "AssignTicket", new { id = Model.Id })
						</h2>
					</div>

				}

				<!-- Bread crumbs -->
				<div class="breads pull-right">
					@*<strong>Nav</strong> : <a href="#">Home</a> / <a href="#">Sign</a> / Home*@
				</div>
				<div class="clearfix"></div>
			</div>

			<div>
				<br />
				<dl class="dl-horizontal">
					<dt>
						Assigned to User
					</dt>

					<dd>
						@Html.DisplayFor(model => model.AssignedToUser.FullName)
					</dd>

					<dt>
						Ticket Owner
					</dt>

					<dd>
						@Html.DisplayFor(model => model.OwnerUser.FullName)
					</dd>

					<dt>
						Priority
					</dt>

					<dd>
						@Html.DisplayFor(model => model.Priority.Name)
					</dd>

					<dt>
						Project
					</dt>

					<dd>
						@Html.DisplayFor(model => model.Project.Name)
					</dd>

					<dt>
						Status
					</dt>

					<dd>
						@Html.DisplayFor(model => model.Status.Name)
					</dd>

					<dt>
						Type
					</dt>

					<dd>
						@Html.DisplayFor(model => model.Type.Name)
					</dd>

					<dt>
						Title
					</dt>

					<dd>
						@Html.DisplayFor(model => model.Title)
					</dd>

					<dt>
						Description
					</dt>

					<dd>
						@Html.DisplayFor(model => model.Description)
					</dd>

					<dt>
						Created
					</dt>

					<dd>
						@Html.DisplayFor(model => model.Created, "{0:dd-MMM-yyyy}")
					</dd>

					<dt>
						Updated
					</dt>

					<dd>
						@Html.DisplayFor(model => model.Updated)
					</dd>
				</dl>
			</div>

			<table id="table_Histories" class="table">
				<thead>
					<tr>
						<th>
							Ticket Title
						</th>
						<th>
							Editor
						</th>
						<th>
							Property
						</th>
						<th>
							Old Value
						</th>
						<th>
							New Value
						</th>
						<th>
							Date Changed
						</th>

					</tr>
				</thead>
				<tbody>
					@foreach (var item in Model.History)
					{

						<tr>
							<td>
								@Html.DisplayFor(modelItem => item.Ticket.Title)
							</td>
							<td>
								@Html.DisplayFor(modelItem => item.User.FullName)
							</td>
							<td>
								@Html.DisplayFor(modelItem => item.Property)
							</td>

							<td>
								@Html.DisplayFor(modelItem => item.OldValue)
							</td>

							<td>
								@Html.DisplayFor(modelItem => item.NewValue)
							</td>

							<td>
								@Html.DisplayFor(modelItem => item.Changed)
							</td>
							@*<td>

									@if (User.IsInRole("Admin"))
									{
										@Html.ActionLink("Edit | ", "Edit", "TicketHistories", new { id = item.Id }, null)
										@Html.ActionLink("Details | ", "Details", "TicketHistories", new { id = item.Id }, null)
										@Html.ActionLink("Delete", "Delete", "TicketHistories", new { id = item.Id }, null)
									}

								</td>*@

						</tr>
					}
				</tbody>
			</table>

			@*<script>
					$('#mytable').DataTable();
				</script>*@




			<div class="form-horizontal">
				<hr />
				<br />


				@Html.ValidationSummary(true, "", new { @class = "text-danger" })

				<table id="table_Comments" class="table">
					<thead>
						<tr>
							<th>
								<h4>Comments</h4>
							</th>
							<th>
								<h4>Revision</h4>
							</th>

						</tr>
					</thead>
					<tbody>

						@foreach (var comm in Model.Comment)
			{
				<tr>
					<td>
						@*<div class="page-grid">
				<div class="container">
					<div class="row show-grid">
						<div class="col-md-10">*@
						<h6>
							@Html.DisplayFor(model => comm.User.FullName) at @Html.DisplayFor(model => comm.Created, "{0:dd-MMM-yyyy}")
							, updated on @Html.DisplayFor(model => comm.Updated, "{0:dd-MMM-yyyy}")
						</h6>

						<h4>@Html.DisplayFor(model => comm.Body)</h4>

						<img class="img-responsive" src="@comm.FileUrl" alt="">
						@*</div>*@

					</td>
					<td>
						@*<div class="col-md-2">*@

						@if (comm.User.UserName == User.Identity.Name)
			{
				<h3>@Html.ActionLink("Edit", "Edit", "TicketComments", new { id = comm.Id }, null)</h3>
}


						@if (User.IsInRole("Admin") || User.IsInRole("Project Manager"))
			{
				<h3>
					@Html.ActionLink("Edit ----- ", "Edit", "TicketComments", new { id = comm.Id }, null)
					@Html.ActionLink("Delete", "Delete", "TicketComments", new { id = comm.Id }, null)
				</h3>
}
			@*</div>
			</div>
		</div>
	</div>*@
					</td>
				</tr>
}
					</tbody>
				</table>

				<script>
					$('#table_Histories, #table_Comments').DataTable();
				</script>

				@*<script>
					$(document).ready(function () {
						$('#example').DataTable({
							"scrollX": true
						});
					});
				</script>*@

				<br />
				<div>
					@using (Html.BeginForm("Create", "TicketComments", FormMethod.Post, new { enctype = "Multipart/form-data" }))
		{
			@Html.AntiForgeryToken()
			@*@Html.Hidden("TicketId", Model.Id)*@
//already passing the ticketId in Hidden statement above to the below in the input

			<input name="TicketId" value="@Model.Id" hidden />
			<div class="form-group">
				<div class="col-md-offset-2 col-md-12">

					<textarea name="Body" id="editor1" rows="10" cols="80" placeholder="Enter Comment" maxlength="5000"></textarea>

					<input name="image" type="file" class="form-control" id="fileUpload" />
				</div>
			</div>
			<div class="form-group">
				<div class="col-md-offset-2 col-md-12">
					@if (Request.IsAuthenticated)
		{
			<input type="submit" value="Submit Comment" class="btn btn-default" />
}
else
{ <h4>LOGIN OR REGISTER TO SUBMIT COMMENTS</h4>
			<input disabled type="submit" value="Submit Comment" class="btn btn-default" />
}
				</div>
			</div>
}
				</div>

				<p>
					@Html.ActionLink("Edit", "Edit", new { id = Model.Id }) |
					@Html.ActionLink("Back to List", "MyTickets")
				</p>

			</div>
		</div>
	</div>
	@section Scripts {
		@Scripts.Render("~/bundles/jqueryval")
	$(function(){
		$().DataTable();
	});
	}
